Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"
********************************************************************************

2. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов
есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц
более актуальны, но регламенты на 5 ГГц существенно различаются в разных
странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне
зачета, попробуйте найти актуальный ответ и на этот вопрос.

Диапазон 2,4 ГГц

    Основным регламентирующим документом в России является Постановление
Правительства РФ от 12.10.2004 N 539 (ред. от 22.12.2018) "О порядке регистрации радиоэлектронных средств и высокочастотных устройств".
    Данный диапазон частот соответствует международному диапазону ISM
(Industrial, Scientific, Medical - Промышленный, Научный, Медицинский),
который также разрешен к использованию без получения лицензии, а именно его
"научной" части 2400-2500 МГц. Разрешенный в России диапазон включает в себя 13
каналов шириной в 20 МГц и частотным шагом в 5 МГц.
    Из них независимыми или непересекающимися являются только три канала: 1-й,
6-й и 11-й. Формально в России можно отнести к непересекающися и наборы 2-7-12 и
3-8-13, но практически это не имеет никакого смысла. В большинстве стран Европы
и Америки в данном диапазоне доступны только 11 каналов, которые не оставляют
иных вариантов, кроме как 1-6-11.

Диапазон 5 ГГц

    В России данный диапазон регулируется пунктом 23 указанного выше
Постановления.
    5 ГГц - это не единый диапазон, а целый ряд диапазонов, порядок
использования которых в различных странах может отличаться.
    Частотная сетка диапазона предусматривает использования для Wi-Fi только непересекающихся каналов шириной 20 МГц и с шагом 20 МГц, от начала и конца
полосы частотный отступ составляет 30 МГц. Первоначально были разрешены к
использованию полосы UNII-1 (Европа, Россия) и дополнительно к ней UNII-3 и один
канал из "медицинского" ISM (США), позднее к ним добавили полосу UNII-2.
    В дальнейшем, учитывая возросшие требования к ширине каналов была также
добавлена расширенная полоса UNII-2 Extended.
    Диапазон содержит 25 непересекающихся каналов. Но не все так просто,
частотные полосы UNII-2 и UNII-2 Extended выделенные для Wi-Fi пересекаются с
частотами, на которых работают авиационные, судовые и военные радары, а также
погодные радары аэродромов. Поэтому использование данных диапазонов возможно
только при использовании технологии DFS (Dynamic Frequency Selection), которая
заключается в том, что точка постоянно мониторит частоту на наличие импульсов от
радара и при наличии таковых обязана изменить рабочий канал.
    В России на текущий момент времени из диапазона UNII-2 Extended разрешено
использование только четырех каналов 132-144, таким образом у нас доступно всего
17 непересекающихся каналов, по четыре в каждой из полос UNII и один в ISM.
********************************************************************************

3. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых
называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC 38:f9:d3:55:55:79?

Производителем устройства с mac-адресом 38:f9:d3:55:55:79 является компания:

Имя компании:	Apple, Inc
Адрес компании:	1 Infinite Loop Cupertino CA 95014 US
Страна:	 US
Приватный:	Нет
Уникальный идентификатор организации:	38:F9:D3
Размер диапазона:	MA-L 
Создан диапазон:	16 авг 2018
Обновлен диапазон:	16 авг 2018
********************************************************************************

4. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер
заголовков IPv4 – 20 байт, а TCP – 32 байта?

payload = MSS = MTU - 20(заголовок IP) - 32(заголовок TCP) = 9001 - 52 = 8949

********************************************************************************

5. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при
штатном режиме работы сети? Почему да или нет?

    Комбинация флага SYN и FIN, устанавливаемого в заголовке TCP, является
недопустимой и относится к категории комбинации недопустимого / ненормального
флага, поскольку она требует как установления соединения (через SYN), так и
прекращения соединения (через FIN).
    Способ обработки таких недопустимых / аномальных комбинаций флагов не
передается в RFC TCP. Таким образом, такие недопустимые / ненормальные
комбинации флагов обрабатываются по-разному в разных операционных системах.
Различные операционные системы также генерируют разные типы ответов для таких
пакетов.
    Это очень большая проблема для сообщества безопасности, потому что
злоумышленники должны использовать эти ответные пакеты, чтобы определить тип
операционной системы в целевой системе для создания своей атаки. Таким образом,
такие комбинации флагов всегда рассматриваются как вредоносные, и современные
системы обнаружения вторжений обнаруживают такие комбинации, чтобы избежать
атак.
********************************************************************************

6. ss -ula sport = :53 на хосте имеет следующий вывод:
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
Почему в State присутствует только UNCONN, и может ли там присутствовать,
например, TIME-WAIT?

-u отображать только только сокеты UDP
-l отображать только прослушивающие сокеты (по умолчанию они опущены)
-a отображать как прослушивающие, так и не прослушивающие (для TCP это означает установленные соединения) сокеты.

sport = :53 порт 53/TCP,UDP	DOMAIN (Domain Name System, DNS)

    TIME-WAIT - означает ожидание, пока пройдет достаточно времени, чтобы
убедиться, что удаленный TCP получил подтверждение своего запроса на завершение
соединения.
    Протокол TCP двунаправленный, упорядоченный и надежный для передачи данных
между двумя конечными точками (программами). Термин надежный означает, что он
будет повторно передавать пакеты, если они будут потеряны. TCP гарантирует
надежность, отправляя обратно пакеты подтверждения (ACK) для одного или
нескольких пакетов, полученных от однорангового узла.
    То же самое и с управляющими сигналами, такими как запрос / ответ на
завершение. RFC 793 определяет состояние TIME-WAIT
    TCP-соединение можно разделить на 3 стадии:
-Установка соединения
-Передача данных
-Завершение соединения

UDP может сразу же начать передачу пакетов. Такими свойствами как TCP не
обладает. Состояние TIME-WAIT присутствовать не может.
********************************************************************************

7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от
инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях
будет находиться TCP соединение в каждый момент времени на клиенте и на сервере
при завершении. Схема переходов состояния соединения вам в этом поможет.

Завершение соединения (устройство, инициирующее выключение, ведёт себя иначе,
чем то, которое получает запрос на прерывание).
а) Клиент посылает серверу флаг FIN на завершение соединения
б) Сервер отвечает клиенту флагами ответа ACK (подтверждение получения сообщения
о закрытии), FIN, что соединение закрыто
в) Как только клиент получает эти флаги, он закрывает соединение и для
подтверждения отправляет серверу ACK, что соединение закрыто.

Согласно схеме:
а) Клиент
ESTABLISHED -> FIN-WAIT-1 -> FIN-WAIT-2 -> TIME-WAIT -> CLOSED
б) Сервер
ESTABLISHED -> CLOSE-WAIT -> LAST-ACK -> CLOSED
********************************************************************************

8. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста
устанавливают между собой соединения. Каким будет теоретическое максимальное
число соединений, ограниченное только лишь параметрами L4, которое параллельно
может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше
одного?

Клиент с одного IP адреса к серверу с одним IP адресом теоретически может
установить 64КБ соединений (65536).

Один клиент не может открыть более 65535 одновременных подключений к серверу.

Еесли клиентов больше одного
Зависит от ресурсов сервера (RAM, CPU, I/O). Они ограничены и в зависимости от
реализации сервера, он может обрабатывать лишь какое-то ограниченное число
одновременных соединений, IP*64k
********************************************************************************

9. Может ли сложиться ситуация, при которой большое число соединений TCP на
хосте находятся в состоянии TIME-WAIT? Если да, то является ли она хорошей или
плохой? Подкрепите свой ответ пояснением той или иной оценки.

TIME_WAIT - это нормально. состояние после закрытия сокета, используемое ядром
для отслеживания пакетов.
Большое количество соединений TIME_WAIT появляется если запускается много
короткоживущих процессов. Плохо тем, что отхватывает много оперативной памяти и
файловых дескрипторов.
Главная опасность которою несет разрастание очереди TIME_WAIT на сервере — это
исчерпание ресурсов.
********************************************************************************

10. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

UDP
    Если длина IPv4 пакета с UDP будет превышать MTU (для Ethernet по умолчанию
1500 байт), то отправка такого пакета может вызвать его фрагментацию, что может
привести к тому, что он вообще не сможет быть доставлен, если промежуточные
маршрутизаторы или конечный хост не будут поддерживать фрагментированные IP
пакеты. Рекомендуется отправлять IP пакеты большего размера только в том случае
если вы уверены, что принимающая сторона может принять пакеты такого размера.

TCP
    Если на каком-либо узле фрагментация запрещена, то со стороны пользователя
это выглядит как «зависание» соединений. При этом «зависание» может происходить
в произвольные моменты времени, а именно тогда, когда отправитель использовал
сегменты длиннее допустимого размера. Для решения этой проблемы на
маршрутизаторах применяются правила Firewall-а, добавляющие параметр MSS во все
пакеты, инициирующие соединения, чтобы отправитель использовал сегменты
допустимого размера.
********************************************************************************

11. Если бы вы строили систему удаленного сбора логов, то есть систему, в
которой несколько хостов отправяют на центральный узел генерируемые приложениями
логи (предположим, что логи – текстовая информация), какой протокол
транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение
самостоятельно, узнав о стандартном протоколе syslog.

Syslog работает по TCP и UDP на портах 514. Некоторые сетевые устройства могут
отправлять данные Syslog через 1468 TCP порт для обеспечения доставки сообщений.
На самом деле, можно оставить только один протокол, например, более безопасный и
медленный TCP. Используя UDP в качестве транспорта можно потерять сообщения
из-за перегрузки сети или потери пакетов. Также есть некоторые проблемы
безопасности.
Удобнее использовать UDP как оказывающий меньшее влияние на загруженность узла и
сети.
********************************************************************************

12. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной
машине с Ubuntu, и каким процессам они принадлежат?

systemd - 111 порт
sshd - 22 порт
заглушка DNS из systemd-resolved - 53 порт

Скрины - 12_01.png 12_02.png
********************************************************************************

13. Какой ключ нужно добавить в tcpdump, чтобы он начал выводить не только
заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и
шестнадцатиричном?

Ключи
-A - tcpdump будет отображать на экране содержимое пакетов в формате ASCII
Печатные символы будут показаны в обычном виде, а остальные символы будут
заменены точками. В виде понятного текста можно увидеть только информацию,
которая передаётся в виде обычного текста. Бинарные данные и зашифрованный
трафик будет нечитаем.
-XX - печатает заголовки (включая канального уровня) и данные в
шестнадцатеричном виде и в ASCII.

Скрины - 13_01.png 13_02.png
********************************************************************************

14. Попробуйте собрать дамп трафика с помощью tcpdump на основном интерфейсе
вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно
ограничить число пакетов -c 100). Встретились ли вам какие-то установленные
флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают.
Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш
дамп? Можно ли где-то в дампе увидеть OUI?

sudo tcpdump -# -w ./test.pcap -i eth0 -c100 -nn -vvv

Флаги: 3 бита
Бит 0: Зарезервированное значение, должен быть равен 0.
Бит 1 (DF): Не фрагментировать (англ. Don't Fragment).
    0 — можно фрагментировать,
    1 — нельзя.
Также может использоваться при определении путевого значения MTU, которое равно
максимальному размеру пакета, передаваемого по пути без фрагментации. Пометив
этот бит, отправитель гарантирует, что либо дейтаграмма дойдет единым блоком,
либо отправитель получит сообщение об ошибке.
Бит 2 (MF): Продолжение следует. У пакета ещё есть фрагменты.
    0 — в последнем фрагменте, 1 — в предыдущих.

Ethernet в основном описывается стандартами IEEE группы 802.3

Можно.
Wireshark автоматизирует поиск OUI, что позволяет определить поставщика любого
сетевого адаптера. Необходимо знать IP-адрес или имя хоста целевой машины.
Один из способов выполнить поиск OUI на хосте - пропинговать его.
После того, как сеанс захвачен и отфильтрован, щелкнуть на любом захваченном
кадре и прокрутите вниз до Ethernet II заголовок кадра в Детали пакета
Посмотреть.

Файл дампа - test.pcap
********************************************************************************
