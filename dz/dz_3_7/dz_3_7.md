Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"
********************************************************************************

1. На лекции мы обсудили, что манипулировать размером окна необходимо для
эффективного наполнения приемного буфера участников TCP сессии (Flow Control).
Подобная проблема в полной мере возникает в сетях с высоким RTT. Например, если
вы захотите передать 500 Гб бэкап из региона Юга-Восточной Азии на Восточное
побережье США. Здесь вы можете увидеть и 200 и 400 мс вполне реального RTT.
Подсчитайте, какого размера нужно окно TCP чтобы наполнить 1 Гбит/с канал при
300 мс RTT (берем простую ситуацию без потери пакетов). Можно воспользоваться
готовым калькулятором. Ознакомиться с формулами, по которым работает калькулятор
можно, например, на Wiki.

Wiki
Ограничение, вызванное размером окна, можно рассчитать следующим образом:
Throughput <= RWIN / RTT
где Throughput - Пропускная способность
RWIN - это окно приема TCP
RTT - время приема-передачи для пути.

Если всё правильно понял, окно должно равняться 37500000 байт.

Полоса пропускания (бит/сек) * RTT (круговое время передачи по сети) = размер окна в битах
1 000 000 000 * 0,300 / 8 = 37500000 байт

Калькулятор (https://www.switch.ch/network/tools/tcp_throughput/)
Полоса пропускания-задержка Произведение и размер буфера
BDP (1000 Мбит / с, 300,0 мс) = 37,50 МБ,
требуемый буфер tcp для достижения 1000 Мбит / с с RTT 300,0 мс> = 36621,1 КБ
максимальной пропускной способности с окном TCP 37500 КБ и RTT 300,0 мс <= 1024,00 Мбит / с.
********************************************************************************

2. Во сколько раз упадет пропускная способность канала, если будет 1% потерь
пакетов при передаче?

В зависимости от полосы пропускания и RTT падение может варироваться. Может
падать как в 10, так и в 100 раз.

Диаграмма - скрин 02_01.png
********************************************************************************

3. Какая максимальная реальная скорость передачи данных достижима при линке
100 Мбит/с? Вопрос про TCP payload, то есть цифры, которые вы реально увидите в операционной системе в тестах или в браузере при скачивании файлов. Повлияет ли
размер фрейма на это?

    Цифры указывают размер (в байтах) заголовка для определенного протокола.
IFG (Interframe gap) — обязательное межкадровое пространство.
Заголовки: preamble, frame delimiter, Ethernet header/FCS – 26 bytes, IFG – 12 bytes, IP header – 20 bytes, TCP header – 20 bytes.
    Если исключить VLAN tagging, TCP timestamp и другие опциональные возможности, максимальная полезная нагрузка (Payload) TCP в сетях Ethernet будет:
Max TCP Payload= (MTU–TCP–IP) / (MTU+Ethernet+IFG) = (1500–40) / (1500+26+12) = 94.9 %
    Размер фрейма, судя по формуле повлияет на реальную скорость.

В ОС и приложениях и браузерах цифры будут отличаться хотя бы по той причине,
что скорость передачи, многие из них, указывают не в битах, а в байтах.

Скрин - 03_01.png
********************************************************************************

4. Что на самом деле происходит, когда вы открываете сайт? :) На прошлой лекции
был приведен сокращенный вариант ответа на этот вопрос. Теперь вы знаете намного
больше, в частности про IP адресацию, DNS и т.д. Опишите максимально подробно
насколько вы это можете сделать, что происходит, когда вы делаете запрос
curl -I http://netology.ru с вашей рабочей станции. Предположим, что arp кеш
очищен, в локальном DNS нет закешированных записей.

    - Поиск IP-адреса сервера, на котором находится сайт (arp кэш и т.д. у себя,
      у роутера;
    - Формируется запрос к DNS-серверам в интернете (., ru., etology.ru.);
    - После определения IP-адреса производится попытка установить с ним
      соединение (по TCP);
    - Отправляется SYN-пакет серверу;
        10.0.2.15.59540 > 104.22.48.171.80: Flags [S]
    - Сервер отвечает запросом с подтверждением получения - SYN/ACK-пакет;
    - Устройство пользователя, получив SYN/ACK-пакет отправляет ACK-пакет с
      подтверждением. В этот момент соединение считается установленным.
        10.0.2.15.59540 > 104.22.48.171.80: Flags [.]
    - Когда одна сторона отправляет N байтов, то увеличивает значение поля SEQ
      на это число;
        10.0.2.15.59540 > 104.22.48.171.80: Flags [P.]
    - Когда вторая сторона подтверждает получение этого пакета (или цепочки
      пакетов), она отправляет пакет ACK, в котором значение поля ACK равняется
      последней полученной последовательности.
        10.0.2.15.59540 > 104.22.48.171.80: Flags [.]
    - Для закрытия соединения, отправляется пакет FIN;
        10.0.2.15.59540 > 104.22.48.171.80: Flags [F.]
    - Другая сторона подтверждает FIN (с помощью ACK) и отправляет собственный
      FIN-пакет;
    - Инициатор прекращения соединения подтверждает получение FIN отправкой
      собственного ACK.
        10.0.2.15.59540 > 104.22.48.171.80: Flags [.]

Скрины - 04_01.png, 04_02.png
********************************************************************************

5. Сколько и каких итеративных запросов будет сделано при резолве домена
www.google.co.uk?

Опция +trace включает трассировку пути делегирования от корневых серверов имён
для искомого имени. Трассировка отключена по умолчанию. Когда трассировка
включена, dig выполняет итеративные запросы, чтобы преобразовать имя, которое
было запрошено. Он будет следовать рекомендациям от корневых серверов, показывая
ответ от каждого сервера, который использовался для разрешения поиска.

sudo dig +trace any www.google.co.uk

Получилось
    13 запросов к корневым серверам (.)
    10 запросов к авторитативным серверам домена uk.
    4 запроса к авторитативным серверам домена google.com.
    и 4 запроса к авторитативным серверам домена co.uk.
Ответ
    A-запись www.google.co.uk. соответствует адресу 142.250.150.94
    AAAA-запись (IPv6) соответствует адресу 2a00:1450:4010:c1c::5e
Получено от 216.239.32.10#53(ns1.google.com)

Скрин - 05_01.png
********************************************************************************

6. Сколько доступно для назначения хостам адресов в подсети /25? А в подсети с
маской 255.248.0.0. Постарайтесь потренироваться в ручных вычислениях чтобы
немного набить руку, не пользоваться калькулятором сразу.

В подсети /25 доступно для назначения хостам 126 адресов (-0 и -128)
Например 192.168.0.0/25 диапазон от 192.168.0.0 до 192.168.0.128
В подсети с маской 255.248.0.0 доступно для назначения хостам 524286 адресов
Например 192.168.0.0 маска 255.248.0.0 диапазон от 192.168.0.0 до 192.175.255.255
********************************************************************************

7. В какой подсети больше адресов, в /23 или /24?
/23 подсеть имеет 512 адресов, /24 подсеть 256 адресов
Соответственно больше адресов в /23 подсети
********************************************************************************

8. Получится ли разделить диапазон 10.0.0.0/8 на 128 подсетей по 131070 адресов
в каждой? Какая маска будет у таких подсетей?

Получится
10.0.0.0/8 (255.0.0.0) - 10.0.0.0 - 10.255.255.255
Максимум - 16777214 адресов хостов
131070 хостов в подсети с маской /15 (255.254.0.0)
********************************************************************************
